/*
 * Converted from nswclibr.f, a public domain work of the United States
 * Government, available at https://dev.aao.org.au/rds/nswc among other
 * places.
 * Conversion by Ray Chason, 2023.
 * Comments are as in the original code. Changes are made for Annex F
 * conformance.
 */

#include <math.h>
#include "derfc0.h"

double
erf(double x)
{
//-----------------------------------------------------------------------
//        DOUBLE PRECISION EVALUATION OF THE ERROR FUNCTION
//-----------------------------------------------------------------------
    double ax, t, w;
//-------------------------------
    static const double a[] = {
         .1283791670955125738961589031215E+00,
        -.3761263890318375246320529677070E+00,
         .1128379167095512573896158902931E+00,
        -.2686617064513125175943235372542E-01,
         .5223977625442187842111812447877E-02,
        -.8548327023450852832540164081187E-03,
         .1205533298178966425020717182498E-03,
        -.1492565035840625090430728526820E-04,
         .1646211436588924261080723578109E-05,
        -.1636584469123468757408968429674E-06,
         .1480719281587021715400818627811E-07,
        -.1229055530145120140800510155331E-08,
         .9422759058437197017313055084212E-10,
        -.6711366740969385085896257227159E-11,
         .4463222608295664017461758843550E-12,
        -.2783497395542995487275065856998E-13,
         .1634095572365337143933023780777E-14,
        -.9052845786901123985710019387938E-16,
         .4708274559689744439341671426731E-17,
        -.2187159356685015949749948252160E-18,
         .7043407712019701609635599701333E-20
    };
//-------------------------------
    if (isnan(x) || x == 0.0) {
        return x;
    }
//
//                     DABS(X) .LE. 1
//
    ax = fabs(x);
    if (ax <= 1.0) {
        t = x*x;
        w = a[20];
        for (unsigned k = 20; k-- != 0; ) {
            w = t*w + a[k];
        }
        return x*(1.0 + w);
    }
//
//                     DABS(X) .GT. 1
//
    else if (ax < 8.5) {
        return copysign(0.5 + (0.5 - exp(-x*x)*__dj_derfc0(ax)), x);
    }
//
//                 LIMIT VALUE FOR LARGE X
//
    else {
        return copysign(1.0, x);
    }
}
